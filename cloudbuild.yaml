---
serviceAccount: 'projects/$PROJECT_ID/serviceAccounts/eclipse-builds@eclipse-362422.iam.gserviceaccount.com'
steps:
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args:
  - '-c'
  - 'docker pull ${_LOCATION}-docker.pkg.dev/$PROJECT_ID/${_IMAGE_NAME}:latest || exit 0'
- name: 'gcr.io/cloud-builders/docker'
  args:
  - 'build'
  - '-t'
  - '${_LOCATION}-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY}/${_IMAGE_NAME}:latest'
  - '--cache-from'
  - '${_LOCATION}-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY}/${_IMAGE_NAME}:latest'
  - '-f'
  - 'Dockerfile'
  - '.'
  env:
  - 'DOCKER_BUILDKIT=1'
  timeout: 3600s
images:
- '${_LOCATION}-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY}/${_IMAGE_NAME}:latest'
substitutions:
  _IMAGE_NAME: neon-proxy
  _LOCATION: us-central1
  _REPOSITORY: eclipse-docker-apps
options:
  machineType: 'E2_HIGHCPU_8'
  logging: CLOUD_LOGGING_ONLY
